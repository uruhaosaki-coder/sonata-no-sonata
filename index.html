<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>そなたのソナタ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            scroll-behavior: smooth;
        }
        
        /* 選択中のボタンスタイル (通常のCSS) */
        .track-button.selected {
            background-color: #D3C34A; /* 黄色 */
            color: #1B2A5C;            /* 濃い青文字 */
            border: 4px solid #fde68a; /* ring-yellow-200 の代わり */
            font-weight: bold;
            padding-top: 1rem;
            padding-bottom: 1rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
    </style>
</head>
<!-- 背景を #717071 (グレー) に変更 -->
<body class="bg-[#717071] flex items-center justify-center min-h-screen p-4">

    <!-- カードの背景色を #1B2A5C (濃い青) に変更 -->
    <div class="w-full max-w-2xl bg-[#1B2A5C] rounded-lg shadow-xl p-6">
        <!-- タイトルの文字色を #D3C34A (黄色) に変更 -->
        <h1 class="text-2xl font-bold text-center text-[#D3C34A] mb-6">そなたのソナタ</h1>

        <!-- トラック選択ボタン -->
        <div id="button-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mb-6 w-full">
            <template id="track-button-template">
                <!-- Trackボタン: 白背景(bg-white)、青文字(text-[#1B2A5C]) -->
                <button class="track-button text-[#1B2A5C] font-bold py-4 px-2 rounded-lg bg-white hover:bg-gray-100 transition-all duration-200 shadow-md text-sm border-4 border-transparent">
                    Track
                </button>
            </template>
        </div>

        <!-- 操作ボタン -->
        <div class="flex space-x-4">
            <button id="play-button" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-lg transition duration-300">
                再生
            </button>
            <button id="stop-button" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-lg transition duration-300">
                停止
            </button>
        </div>

        <!-- ステータス表示 (明るいグレー) -->
        <div id="status" class="text-center text-gray-300 mt-4 h-6"></div>
    </div>

    <script>
        // --- ▼ 音源設定 (GitHub Pagesアップロード用) ▼ ---
        
        // !【重要】このファイルは GitHub Pages にアップロードするためのものです。
        // ! このまま「プレビュー」しても "ファイルが見つからない" というエラーになりますが、
        // ! これは正常な動作です。
        
        // !【警告】 'a.m4a' などの .m4a 形式のファイルは、多くのブラウザで再生エラーになります。
        // ! もし GitHub Pages で音が鳴らない場合は、
        // ! 必ず音源を .mp3 形式に変換し、ここのファイル名も "a.mp3" などに修正してください。
        
        // !【修正】 .m4a ではなく、 .mp3 形式を使うことを強く推奨します。
        // ! ガイドに従って .mp3 に変換したファイル名に書き換えてあります。

        // 再生開始時に鳴る音
        const A_URL = "a.mp3";

        // 再生終了時に鳴る音
        const B_URL = "b.mp3";

        // 選択する10種類の音トラック
        const TRACK_URLS = [
            "a.mp3",      // Track 1
            "b.mp3",      // Track 2
            "track3.mp3", // Track 3
            "track4.mp3", // Track 4
            "track5.mp3", // Track 5
            "track6.mp3", // Track 6
            "track7.mp3", // Track 7
            "track8.mp3", // Track 8
            "track9.mp3", // Track 9
            "track10.mp3" // Track 10
        ];
        // --- ▲ 音源設定 ▲ ---


        // Audioオブジェクトのインスタンス (使い回します)
        const audioA = new Audio();
        const audioB = new Audio();
        const audioMain = new Audio();
        
        let currentSequence = []; // 再生シーケンスのキュー
        let currentAudio = null; // 現在再生中のAudioオブジェクト

        // DOM要素
        const buttonContainer = document.getElementById('button-container');
        const playButton = document.getElementById('play-button');
        const stopButton = document.getElementById('stop-button');
        const statusEl = document.getElementById('status');
        const template = document.getElementById('track-button-template');

        let selectedTrackIndex = 0; // デフォルトでTrack 1 (インデックス 0) を選択
        let trackButtons = []; // ボタンの参照を保持する配列

        // --- 初期化 ---

        // トラックボタンを生成
        TRACK_URLS.forEach((url, index) => {
            const clone = template.content.cloneNode(true);
            const button = clone.querySelector('.track-button');
            
            button.textContent = `Track ${index + 1}`;
            button.dataset.index = index; 

            button.addEventListener('click', () => {
                selectTrack(index);
            });

            buttonContainer.appendChild(clone);
            trackButtons.push(button); 
        });

        // トラック選択処理
        function selectTrack(index) {
            // ★診断用ログ★
            console.log(`selectTrack called for index: ${index}`); 
            
            selectedTrackIndex = index;
            trackButtons.forEach((btn, i) => {
                // 'selected' クラス (黄色の背景) の付け外し
                btn.classList.toggle('selected', i === index);
            });
            console.log(`Track ${index + 1} selected`);
        }

        // 起動時にデフォルト（Track 1）を選択状態にする
        selectTrack(0);

        // --- 再生ロジック ---

        playButton.addEventListener('click', playSequence);
        stopButton.addEventListener('click', stopAllAudio);

        function playSequence() {
            stopAllAudio(); 
            
            currentSequence = [
                { audio: audioA, url: A_URL, name: "A" },
                { audio: audioMain, url: TRACK_URLS[selectedTrackIndex], name: "Main" },
                { audio: audioB, url: B_URL, name: "B" }
            ];
            
            playNextInSequence();
        }

        function playNextInSequence() {
            if (currentSequence.length === 0) {
                console.log("Sequence finished");
                statusEl.textContent = "再生終了";
                currentAudio = null;
                return;
            }

            const next = currentSequence.shift();
            currentAudio = next.audio;

            currentAudio.removeEventListener('ended', playNextInSequence);
            currentAudio.removeEventListener('error', handleAudioError);
            
            currentAudio.src = next.url;
            
            currentAudio.addEventListener('ended', playNextInSequence);
            currentAudio.addEventListener('error', (e) => handleAudioError(e, next.name));

            statusEl.textContent = `${next.name === 'Main' ? 'Track ' + (selectedTrackIndex + 1) : next.name} を再生中...`;
            console.log(`Playing ${next.name} (URL: ${next.url})`);
            
            currentAudio.play().catch(e => {
                console.error(`Playback error (${next.name}):`, e.message);
                statusEl.textContent = `再生エラー (${next.name})`;
                playNextInSequence();
            });
        }

        function handleAudioError(e, name) {
            console.error(`Audio Playback Error (${name}):`, e);
            statusEl.textContent = `エラー (${name}): ファイル読込失敗`;
            playNextInSequence();
        }

        function stopAllAudio() {
            [audioA, audioB, audioMain].forEach(audio => {
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                    audio.removeEventListener('ended', playNextInSequence);
                    audio.removeEventListener('error', handleAudioError);
                }
            });
            currentSequence = []; 
            currentAudio = null;
            statusEl.textContent = "停止しました";
            console.log("All audio stopped");
        }
    </script>
</body>
</html>
